; OnSpeed Gen3 ESP32 PlatformIO Configuration
;
; This configuration works alongside the existing Arduino IDE setup.
; Source files remain in software/OnSpeed-Gen3-ESP32/ and libraries
; remain in software/Libraries/ as git submodules.
;
; Install PlatformIO: https://platformio.org/
;
; Commands:
;   pio run              - Build firmware
;   pio run -t upload    - Build and upload to device
;   pio run -t clean     - Clean build artifacts
;   pio device monitor   - Serial monitor (921600 baud)

[platformio]
name = OnSpeed-Gen3
description = Open source AOA indicator with audio cues for general aviation
; Use the Arduino sketch folder as the source directory
src_dir = software/OnSpeed-Gen3-ESP32

[env:esp32s3]
; Use pioarduino platform for Arduino Core 3.x support (required for ESP_I2S, <bit>, etc.)
; See: https://github.com/pioarduino/platform-espressif32
platform = https://github.com/pioarduino/platform-espressif32/releases/download/54.03.20/platform-espressif32.zip

; Target hardware: ESP32-S3-WROOM-2-N32R8V (32MB Flash Octal, 8MB PSRAM Octal)
; Board: "ESP32S3 Dev Module Octal (WROOM2)"
board = esp32-s3-devkitc-1-n32r8v
framework = arduino

; Flash settings to match Arduino IDE:
; - Flash Mode: "OPI 80MHz"
; - Flash Size: "32MB (256Mb)"
; - Partition Scheme: "32M Flash (4.8MB APP/22MB LittleFS)"
board_build.flash_mode = opi
board_build.f_flash = 80000000L
board_build.flash_size = 32MB
board_build.partitions = default_32MB.csv

; Upload settings
; - Upload Speed: "921600"
; - Upload Mode: "UART0 / Hardware CDC"
upload_speed = 921600
monitor_speed = 921600

; Build flags to match Arduino IDE settings:
; - USB CDC On Boot: "Disabled"
; - USB Mode: "Hardware CDC and JTAG"
; - PSRAM: "OPI PSRAM"
; - CPU Frequency: "240MHz (WiFi)"
; - Events Run On: "Core 1"
; - Arduino Runs On: "Core 1"
build_flags =
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=0
    -DBOARD_HAS_PSRAM
    -DARDUINO_RUNNING_CORE=1
    -DARDUINO_EVENT_RUNNING_CORE=1

; Use the existing Libraries directory that contains git submodules
; This allows Arduino IDE and PlatformIO to share the same libraries
lib_extra_dirs =
    software/Libraries

build_type = release
